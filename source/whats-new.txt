.. _node-whats-new:

==========
What's New
==========

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. facet::
   :name: genre
   :values: reference
 
.. meta::
   :keywords: version, update, upgrade, backwards compatibility


Learn what's new in:

* :ref:`Version 6.4 <version-6.4>`
* :ref:`Version 6.3 <version-6.3>`
* :ref:`Version 6.2 <version-6.2>`
* :ref:`Version 6.1 <version-6.1>`
* :ref:`Version 6.0 <version-6.0>`

.. _version-6.4:

What's New in 6.4
-----------------

The {+driver-short+} v6.4 release includes the following features:

- When multiple ``mongos`` instances are available, different servers are used
  for read and write retry attempts.

- Caches AWS credentials at the client level, rather than for each
  authentication.

- Upgrades to using BSON 6.4.0. For details about the new BSON features, see the
  release notes for `BSON 6.3.0
  <https://github.com/mongodb/js-bson/releases/tag/v6.3.0>`__ and `BSON 6.4.0
  <https://github.com/mongodb/js-bson/releases/tag/v6.4.0>`__.
  
- Read operations that result in an ``ExceededTimeLimit`` error are retried.

- Fixes a request issue related to :ref:`TLS sockets <node-connect-tls>` and
  :manual:`KMS Providers
  </core/queryable-encryption/fundamentals/kms-providers/>`.

- Fixes the base64 padding on the ``saslContinue`` command to allow for mongosh
  authentication.

- Types ``countDocuments`` using ``Filter<Schema>`` rather than ``Document``,
  which enables autocompletion and helps prevent downstream typing issues.

- Fixes a type error in the ``$addToSet`` option of the ``bulkWrite`` command.
  The driver skips ``$addToSet`` validation you extend your types from
  ``Document`` or ``any``, or use properties of any type.

- Fixes the ``ServerHeartbeatSucceeded`` and ``ServerHeartbeatFailed`` event
  heartbeat duration so that it does not include the time to create the socket.

- Appropriately emits errors from cursor transform streams, rather than
  absorbing them.

- Makes AWS session tokens optional when a username and password are provided,
  and allows AWS SDK to handle the authentication requests.

.. _version-6.3:

What's New in 6.3
-----------------

The {+driver-short+} v6.3 release includes the following features:

- Adds the ``serverMonitoringMode`` client option to control the
  behavior of the monitoring connection among the nodes in a topology.
  This option takes a value of ``auto`` (default), ``poll``, or
  ``stream``. To learn more, see the entry for this option in the
  :ref:`node-connection-options` guide.

  You can set the ``serverMonitoringMode`` option in a
  ``MongoClientOptions`` instance or as a connection string option. The
  following example shows how to create a client with the option set to
  ``stream``:
  
  .. code-block:: js
     
     new MongoClient('<connection string>', { serverMonitoringMode: 'stream' });

- Fixes a connection leak when the ``serverApi`` client option is set.

- Deprecates the ``contentType`` and ``aliases`` GridFS options. To
  store the content type and aliases of a file, add ``contentType`` and ``aliases``
  fields to the ``metadata`` document.

To learn more about this release, see the
`v6.3.0 Release Highlights
<https://github.com/mongodb/node-mongodb-native/releases/tag/v6.3.0>`__.

.. _version-6.2:

What's New in 6.2
-----------------

The {+driver-short+} v6.2 release includes the following features:

- Updates the ``bson`` package version to 6.2.0 to include
  color visualization of types, as shown in the following image:

  .. figure:: /includes/figures/bson-color.png
     :alt: A screenshot of the terminal that shows printing in color

  To learn more, see the `bson v6.2.0 release notes
  <https://github.com/mongodb/js-bson/releases/tag/v6.2.0>`__.

- Ensures that the ``result.insertedIds`` property of a bulk write error type
  contains the ``_id`` values of successfully inserted documents. In
  previous versions, when a bulk write operation rejected an insert
  operation, the ``result.insertedIds`` property contained the
  ``_id`` values for all attempted inserts.

- Closes the implicit session created when running the ``findOne()``
  method on a time series collection regardless of the outcome of the
  operation.

- Allows the creation of collections that have names that start or end with the
  ``.`` character. This change aligns the driver's database and
  collection name-checking behavior with the server's.

To learn more about this release, see the
`v6.2.0 Release Highlights
<https://github.com/mongodb/node-mongodb-native/releases/tag/v6.2.0>`__.

.. _version-6.1:

What's New in 6.1
-----------------

The {+driver-short+} v6.1 release includes the following features:

- Updates the ``bson`` package version to 6.1.0 to expose the
  ``Decimal128.fromStringWithRounding()`` method. To learn more, see the
  `v6.1.0 bson release notes <https://github.com/mongodb/js-bson/releases/tag/v6.1.0>`__.

- Detects environment variables for region settings when
  authenticating by using the ``MONGODB-AWS`` authentication mechanism.
  To instruct the driver to use your region options, you must set both
  of the following environment variables:
  
  - ``AWS_STS_REGIONAL_ENDPOINTS``
  - ``AWS_REGION``

- Fixes a memory leak issue caused by recursive calls to the ``next()``
  method of the ``ChangeStream`` type.

To learn more about this release, see the
`v6.1.0 Release Highlights
<https://github.com/mongodb/node-mongodb-native/releases/tag/v6.1.0>`__.

.. _version-6.0:

What's New in 6.0
-----------------

.. warning:: Breaking Changes in v6.0

   This driver version introduces breaking changes. For a list of these changes, see
   the :ref:`Version 6.0 Breaking Changes section <node-breaking-changes-v6.0>` in the
   Upgrade guide.

The {+driver-short+} v6.0 release includes the following features:

.. important:: Deprecation Notice

   All of the ``ssl``-prefixed options in the ``MongoClientOptions``
   type are deprecated. In addition, the ``tlsCertificateFile`` option
   is deprecated.

   Instead, you should store your certificates in a ``SecureContext``
   object or set the ``tls``-prefixed options in your
   ``MongoClientOptions`` instance. To learn more, see :ref:`node-connect-tls`.

- Removal of support for the ``addUser()`` helper command. Use the
  :manual:`createUser </reference/command/createUser>` MongoDB Shell command instead.

- Removal of support for the ``collStats`` operation. Use the
  :manual:`$collStats </reference/operator/aggregation/collStats>` aggregation operator
  instead.

- The ``options`` field of the ``ConnectionPoolCreatedEvent`` type
  contains only the following fields, which are the non-default pool
  options:

  - ``maxConnecting``
  - ``maxPoolSize``
  - ``minPoolSize``
  - ``maxIdleTimeMS``
  - ``waitQueueTimeoutMS``

- The driver asynchronously reads files set in the ``tlsCAFile`` and
  ``tlsCertificateKeyFile`` connection options when you call
  the ``MongoClient.connect()`` method, not when you create a
  ``MongoClient`` instance.

- Removal of the ``keepAlive`` and ``keepAliveInitialDelay`` connection
  options. The value of ``keepAlive`` is permanently set to ``true`` and the
  value of ``keepAliveInitialDelay`` is set to 300000 milliseconds (300
  seconds).
  
  To learn how to set keepalive settings at a system level,
  see the :manual:`Does TCP keepalive time affect MongoDB Deployments? </faq/diagnostics/#does-tcp-keepalive-time-affect-mongodb-deployments->`
  FAQ entry in the Server manual.

- Removes the following options for the ``Db.command()`` method:
  
  - ``willRetryWrite``
  - ``omitReadPreference``
  - ``writeConcern``
  - ``explain``
  - ``readConcern``
  - ``collation``
  - ``maxTimeMS``
  - ``comment``
  - ``retryWrites``
  - ``dbName``
  - ``authdb``
  - ``noResponse``

  Although you cannot pass these options to the
  ``Db.command()`` method, you can still set them in the command
  document. To learn more, see the :ref:`Command Options
  <node-command-options>` section of the Run a Command guide.

To learn more about this release, see the
`v6.0.0 Release Highlights <https://github.com/mongodb/node-mongodb-native/releases/tag/v6.0.0>`__.
