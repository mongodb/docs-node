.. _node-pkfactory:

=================================
Generate Custom Vales for ``_id``
=================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

Overview
--------

In this guide, you can learn how to use the MongoDB Node.js driver to generate your
own ``_id`` values using the primary key factory.

The primary key factory allows you to create unique identifiers in your
documents when you choose not to specify an ``_id`` during an
:ref:`insert operation <node-fundamentals-insert-data>`. The 
default primary key factory generates ``ObjectId`` values.

.. note:: Upsert Operations

   The driver doesn't use any primary key factory methods for
   :ref:`upsert operations <node-fundamentals-upsert>`. Instead, the
   driver always creates ``ObjectId`` values for the ``_id`` field of
   the upserted documents.

   If you want to use ``pkFactory`` methods, peform a :ref:`find
   operation <node-fundamentals-retrieve-data>`, then an :ref:`update
   <node-fundamentals-change-a-document>` or :ref:`insert
   <node-fundamentals-insert-data>` operation.

Data Consistency
----------------

If you do not specify a primary key factory method that generates
``_id`` values of your desired type, you may experience data
inconsistency.

This may occur because the driver's default primary factory method generates
``_id`` values of type ``ObjectId`` regardless of the type you specify for the 
``_id`` field in your type parameter.

Specify a Primay Key Factory
----------------------------

To specify a primary key factory, apply a ``pkFactory`` option to your
``MongoClient`` instance.

The following code snippet specifies the ``pkFactory`` option to general
``_id`` values of type ``uuid``:

.. code-block:: javascript

   const uuid = require('bson');
   ...
   const client = new MongoClient(uri, { pkFactory: { createPk: () => uuid }});

Additional Information
----------------------

To learn more about the types, interfaces, and classes discussed in this
section, see the following resources:

- `PkFactory <{+api+}/interfaces/PkFactory.html>`__
- :manual:`The _id Field </core/document/#the-_id-field>`
- :ref:`node-fundamentals-upsert`
- :ref:`node-fundamentals-retrieve-data`
- :ref:`node-fundamentals-change-a-document`
- :ref:`node-fundamentals-insert-data`
